(()=>{var e={};e.id=919,e.ids=[919],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},73292:e=>{"use strict";e.exports=require("fs/promises")},71017:e=>{"use strict";e.exports=require("path")},51634:(e,a,s)=>{"use strict";s.r(a),s.d(a,{GlobalError:()=>d.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>l,routeModule:()=>f,tree:()=>c});var t=s(50482),r=s(69108),i=s(62563),d=s.n(i),o=s(68300),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(a,n);let c=["",{children:["os",{children:["[id]",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,31965)),"C:\\Programas\\PROJETOS\\sistema-time-de-campo\\src\\app\\os\\[id]\\admin\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,49223)),"C:\\Programas\\PROJETOS\\sistema-time-de-campo\\src\\app\\layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,92793)),"C:\\Programas\\PROJETOS\\sistema-time-de-campo\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],l=["C:\\Programas\\PROJETOS\\sistema-time-de-campo\\src\\app\\os\\[id]\\admin\\page.tsx"],u="/os/[id]/admin/page",m={require:s,loadChunk:()=>Promise.resolve()},f=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/os/[id]/admin/page",pathname:"/os/[id]/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},58341:(e,a,s)=>{let t={"2dd604a4fa171d5bf4edd119607f12882f2f1233":()=>Promise.resolve().then(s.bind(s,13398)).then(e=>e.getEquipes),"3a7a815bcde402ec80a76d4915ddaa24dd2697a6":()=>Promise.resolve().then(s.bind(s,13398)).then(e=>e.createEquipe),bb9004a81e2ec4420b2b97debd5f27e567e92ef6:()=>Promise.resolve().then(s.bind(s,13398)).then(e=>e.updateProfile),c5f7132601121f48314d1a51ecac279117f08ff6:()=>Promise.resolve().then(s.bind(s,13398)).then(e=>e.updatePreferences),c98ca564b4813ac5836f5e16d8b41e62d1cf9860:()=>Promise.resolve().then(s.bind(s,13398)).then(e=>e.deleteEquipe),e0bf2b8da39f29f7764053adebc46527dec3237e:()=>Promise.resolve().then(s.bind(s,13398)).then(e=>e.updateEquipe),"4f7cc3295bc1862da856a082439e474acd72ddb0":()=>Promise.resolve().then(s.bind(s,67778)).then(e=>e.logout),bbec7576f1f50640a4a678e3194e37400ea45963:()=>Promise.resolve().then(s.bind(s,67778)).then(e=>e.login),"22c53d6cc54bce46a621cc2c18c29a4b6151f7eb":()=>Promise.resolve().then(s.bind(s,36051)).then(e=>e.createNotification),"531833ed2258d48c2a40d41cd7d226d4ccc024cc":()=>Promise.resolve().then(s.bind(s,36051)).then(e=>e.markAsRead),"84b4112fe213bb4e51d524390b924583a28cf4a6":()=>Promise.resolve().then(s.bind(s,36051)).then(e=>e.getUnreadNotifications),a097c09bcedad3830c63ef8bf1297807d0616abc:()=>Promise.resolve().then(s.bind(s,36051)).then(e=>e.markAllAsRead),"2e97a5facdd95a76e159016de9c21bb65bbde3ff":()=>Promise.resolve().then(s.bind(s,7360)).then(e=>e.saveOSAdminInfo)};async function r(e,...a){return(await t[e]()).apply(null,a)}e.exports={"2dd604a4fa171d5bf4edd119607f12882f2f1233":r.bind(null,"2dd604a4fa171d5bf4edd119607f12882f2f1233"),"3a7a815bcde402ec80a76d4915ddaa24dd2697a6":r.bind(null,"3a7a815bcde402ec80a76d4915ddaa24dd2697a6"),bb9004a81e2ec4420b2b97debd5f27e567e92ef6:r.bind(null,"bb9004a81e2ec4420b2b97debd5f27e567e92ef6"),c5f7132601121f48314d1a51ecac279117f08ff6:r.bind(null,"c5f7132601121f48314d1a51ecac279117f08ff6"),c98ca564b4813ac5836f5e16d8b41e62d1cf9860:r.bind(null,"c98ca564b4813ac5836f5e16d8b41e62d1cf9860"),e0bf2b8da39f29f7764053adebc46527dec3237e:r.bind(null,"e0bf2b8da39f29f7764053adebc46527dec3237e"),"4f7cc3295bc1862da856a082439e474acd72ddb0":r.bind(null,"4f7cc3295bc1862da856a082439e474acd72ddb0"),bbec7576f1f50640a4a678e3194e37400ea45963:r.bind(null,"bbec7576f1f50640a4a678e3194e37400ea45963"),"22c53d6cc54bce46a621cc2c18c29a4b6151f7eb":r.bind(null,"22c53d6cc54bce46a621cc2c18c29a4b6151f7eb"),"531833ed2258d48c2a40d41cd7d226d4ccc024cc":r.bind(null,"531833ed2258d48c2a40d41cd7d226d4ccc024cc"),"84b4112fe213bb4e51d524390b924583a28cf4a6":r.bind(null,"84b4112fe213bb4e51d524390b924583a28cf4a6"),a097c09bcedad3830c63ef8bf1297807d0616abc:r.bind(null,"a097c09bcedad3830c63ef8bf1297807d0616abc"),"2e97a5facdd95a76e159016de9c21bb65bbde3ff":r.bind(null,"2e97a5facdd95a76e159016de9c21bb65bbde3ff")}},94936:(e,a,s)=>{let t={"01aa194246fb3cd3909854170a6a003e66db9b89":()=>Promise.resolve().then(s.bind(s,55379)).then(e=>e.getSession),"6025ca35376357c0da7f5b807633b24af797ac4b":()=>Promise.resolve().then(s.bind(s,55379)).then(e=>e.clearSessionCookie),"7f6832b04b751148a6382dd64a1cc223449e53b3":()=>Promise.resolve().then(s.bind(s,55379)).then(e=>e.requireAuth),"8d8f3bd62d0a07b2792f9104701a5c0433fbcdee":()=>Promise.resolve().then(s.bind(s,55379)).then(e=>e.requireAdmin),bbad0871288a94d710af6fbd6788ce5f0465e0e3:()=>Promise.resolve().then(s.bind(s,55379)).then(e=>e.createToken),bdb6b21ecc9aab6757183c887af3cd3c576bd3b3:()=>Promise.resolve().then(s.bind(s,55379)).then(e=>e.setSessionCookie)};async function r(e,...a){return(await t[e]()).apply(null,a)}e.exports={"01aa194246fb3cd3909854170a6a003e66db9b89":r.bind(null,"01aa194246fb3cd3909854170a6a003e66db9b89"),"6025ca35376357c0da7f5b807633b24af797ac4b":r.bind(null,"6025ca35376357c0da7f5b807633b24af797ac4b"),"7f6832b04b751148a6382dd64a1cc223449e53b3":r.bind(null,"7f6832b04b751148a6382dd64a1cc223449e53b3"),"8d8f3bd62d0a07b2792f9104701a5c0433fbcdee":r.bind(null,"8d8f3bd62d0a07b2792f9104701a5c0433fbcdee"),bbad0871288a94d710af6fbd6788ce5f0465e0e3:r.bind(null,"bbad0871288a94d710af6fbd6788ce5f0465e0e3"),bdb6b21ecc9aab6757183c887af3cd3c576bd3b3:r.bind(null,"bdb6b21ecc9aab6757183c887af3cd3c576bd3b3")}},59951:(e,a,s)=>{Promise.resolve().then(s.t.bind(s,61476,23)),Promise.resolve().then(s.bind(s,21149)),Promise.resolve().then(s.bind(s,85740))},31498:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(51091).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},14513:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(51091).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},21149:(e,a,s)=>{"use strict";s.r(a),s.d(a,{OSAdminEditForm:()=>h});var t=s(95344),r=s(3729),i=s(8428),d=s(5094),o=s(46540),n=s(2690);s(13664);var c=(0,s(28371).$)("2e97a5facdd95a76e159016de9c21bb65bbde3ff"),l=s(51091);let u=(0,l.Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),m=(0,l.Z)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);var f=s(14513),p=s(31498),b=s(34755);function h({osId:e,initialData:a}){let[s,l]=(0,r.useState)(!1),[h,x]=(0,r.useState)(a?.condominio||""),[g,v]=(0,r.useState)(a?.descricao||""),[y,w]=(0,r.useState)([]),[P,N]=(0,r.useState)(a?.attachments||[]),[j,q]=(0,r.useState)([]),E=(0,i.useRouter)(),A=e=>{w(a=>a.filter((a,s)=>s!==e))},k=e=>{N(a=>a.filter(a=>a.id!==e)),q(a=>[...a,e])},S=async a=>{a.preventDefault(),l(!0);let s=new FormData;s.append("osId",e),s.append("condominio",h),s.append("descricao",g),y.forEach(e=>{s.append("files",e)}),j.forEach(e=>{s.append("deletedFileIds",e)});let t=await c(s);t.success?(b.Am.success("Informa\xe7\xf5es atualizadas com sucesso!"),E.push(`/os/${e}`),E.refresh()):(b.Am.error(t.message||"Erro ao salvar informa\xe7\xf5es."),l(!1))};return(0,t.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Nome do Condom\xednio"}),t.jsx(o.I,{value:h,onChange:e=>x(e.target.value),placeholder:"Ex: Condom\xednio Garden Park"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Descri\xe7\xe3o / Observa\xe7\xf5es"}),t.jsx(n.g,{value:g,onChange:e=>v(e.target.value),placeholder:"Informa\xe7\xf5es adicionais para a equipe...",className:"h-40 resize-y"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Anexos"}),(0,t.jsxs)("div",{className:"border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl p-6 text-center hover:bg-slate-50/50 dark:hover:bg-slate-800/50 transition-colors relative group",children:[t.jsx("input",{type:"file",multiple:!0,className:"absolute inset-0 opacity-0 cursor-pointer z-10",onChange:e=>{e.target.files&&w(a=>[...a,...Array.from(e.target.files||[])])}}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"p-3 bg-slate-100 dark:bg-slate-800 rounded-full group-hover:bg-slate-200 dark:group-hover:bg-slate-700 transition-colors",children:t.jsx(u,{className:"h-6 w-6 text-slate-500 dark:text-slate-400"})}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:"Clique para fazer upload"}),t.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"ou arraste e solte arquivos aqui"})]})]})]}),(P.length>0||y.length>0)&&(0,t.jsxs)("div",{className:"space-y-2 mt-4",children:[P.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden",children:[t.jsx(m,{className:"h-4 w-4 text-slate-400 shrink-0"}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 truncate",children:e.name}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]})]})]}),t.jsx(d.z,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950/30",onClick:()=>k(e.id),children:t.jsx(f.Z,{className:"h-4 w-4"})})]},e.id)),y.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50/50 dark:bg-blue-950/20 rounded-lg border border-blue-100 dark:border-blue-900/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden",children:[t.jsx(u,{className:"h-4 w-4 text-blue-500 shrink-0"}),(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 truncate",children:e.name}),t.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:"Novo arquivo"})]})]}),t.jsx(d.z,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",onClick:()=>A(a),children:t.jsx(f.Z,{className:"h-4 w-4"})})]},a))]})]}),t.jsx("div",{className:"flex justify-end pt-4",children:t.jsx(d.z,{type:"submit",disabled:s,className:"min-w-[140px] bg-blue-600 hover:bg-blue-700 text-white shadow-sm",size:"lg",children:s?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Salvando..."]}):(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(p.Z,{className:"h-4 w-4"}),"Salvar Altera\xe7\xf5es"]})})})]})}},46540:(e,a,s)=>{"use strict";s.d(a,{I:()=>d});var t=s(95344),r=s(3729),i=s(11453);let d=r.forwardRef(({className:e,type:a,...s},r)=>t.jsx("input",{type:a,className:(0,i.cn)("flex h-11 w-full rounded-md border border-input bg-background px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all",e),ref:r,...s}));d.displayName="Input"},2690:(e,a,s)=>{"use strict";s.d(a,{g:()=>d});var t=s(95344),r=s(3729),i=s(11453);let d=r.forwardRef(({className:e,...a},s)=>t.jsx("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-4 py-3 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a}));d.displayName="Textarea"},26540:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(12589).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},16274:(e,a,s)=>{"use strict";s.d(a,{default:()=>r.a});var t=s(48026),r=s.n(t)},48026:(e,a,s)=>{"use strict";let{createProxy:t}=s(86843);e.exports=t("C:\\Programas\\PROJETOS\\sistema-time-de-campo\\node_modules\\next\\dist\\client\\link.js")},13398:(e,a,s)=>{"use strict";s.r(a),s.d(a,{createEquipe:()=>u,deleteEquipe:()=>m,getEquipes:()=>p,updateEquipe:()=>f,updatePreferences:()=>l,updateProfile:()=>b});var t=s(98601);s(75811);var r=s(50841),i=s(43811),d=s(68474),o=s(28462),n=s(19961);function c(e){return/^[a-zA-Z0-9]+$/.test(e)}async function l(e,a){let s=await (0,d.requireAuth)().catch(()=>null);if(!s)return{message:"N\xe3o autenticado."};try{return await r.prisma.equipe.update({where:{id:s.id},data:{[e]:a}}),n.logger.info("Preferences updated",{userId:s.id,key:e,value:a}),(0,i.revalidatePath)("/os"),{success:!0}}catch(t){if("P2025"===t.code)return n.logger.error("Preferences update failed: User record not found. User needs to re-login.",{userId:s.id}),{message:"Sess\xe3o expirada ou usu\xe1rio n\xe3o encontrado. Por favor, saia e entre novamente."};return n.logger.error("Error updating preferences",{userId:s.id,key:e,value:a,error:String(t)}),{message:"Erro ao salvar prefer\xeancia."}}}async function u(e,a){try{await (0,d.requireAdmin)()}catch{return{message:"N\xe3o autorizado."}}let s=a.get("name"),t=a.get("fullName"),l=a.get("phone"),u=a.get("password"),m="true"===a.get("isAdmin");if(!s||!u||u.length<6)return{message:"Nome de usu\xe1rio e senha (min 6 caracteres) s\xe3o obrigat\xf3rios."};if(!c(s))return{message:"Nome de usu\xe1rio deve conter apenas letras e n\xfameros (sem espa\xe7os)."};try{if(await r.prisma.equipe.findUnique({where:{name:s}}))return{message:"J\xe1 existe um usu\xe1rio com este nome."};let e=await o.default.hash(u,10);return await r.prisma.equipe.create({data:{name:s,fullName:t,password:e,isAdmin:m,phone:l,nomeEquipe:s}}),(0,i.revalidatePath)("/admin/equipes"),{success:!0,message:`${m?"Administrador":"Usu\xe1rio/Equipe"} "${s}" criado com sucesso!`}}catch(e){if(n.logger.error("Error creating equipe",{error:String(e)}),"P2002"===e.code)return{message:"J\xe1 existe um usu\xe1rio com este nome."};return{message:"Erro ao criar usu\xe1rio: "+(e.message||"Erro desconhecido")}}}async function m(e){try{await (0,d.requireAdmin)()}catch{return{message:"N\xe3o autorizado."}}try{return await r.prisma.equipe.delete({where:{id:e}}),(0,i.revalidatePath)("/admin/equipes"),{success:!0}}catch(e){return n.logger.error("Error deleting equipe",{error:String(e)}),{message:"Erro ao remover usu\xe1rio."}}}async function f(e,a){try{await (0,d.requireAdmin)()}catch{return{message:"N\xe3o autorizado."}}try{let s={};if(a.name){if(!c(a.name))return{message:"Nome de usu\xe1rio deve conter apenas letras e n\xfameros."};s.name=a.name}return void 0!==a.fullName&&(s.fullName=a.fullName),void 0!==a.phone&&(s.phone=a.phone),a.password&&a.password.length>=6&&(s.password=await o.default.hash(a.password,10)),void 0!==a.isAdmin&&(s.isAdmin=a.isAdmin),await r.prisma.equipe.update({where:{id:e},data:s}),(0,i.revalidatePath)("/admin/equipes"),{success:!0,message:"Usu\xe1rio atualizado!"}}catch(e){return n.logger.error("Error updating equipe",{error:String(e)}),{message:"Erro ao atualizar usu\xe1rio."}}}async function p(){return r.prisma.equipe.findMany({select:{id:!0,name:!0,fullName:!0,nomeEquipe:!0,phone:!0,isAdmin:!0,createdAt:!0,updatedAt:!0},orderBy:{createdAt:"desc"}})}async function b(e){let a=await (0,d.requireAuth)().catch(()=>null);if(!a)return{message:"N\xe3o autenticado."};try{let s={};if(e.name){if(!c(e.name))return{message:"Nome de usu\xe1rio deve conter apenas letras e n\xfameros."};if(await r.prisma.equipe.findFirst({where:{name:e.name,NOT:{id:a.id}}}))return{message:"Este nome de usu\xe1rio j\xe1 est\xe1 em uso."};s.name=e.name}return void 0!==e.fullName&&(s.fullName=e.fullName),void 0!==e.phone&&(s.phone=e.phone),e.password&&e.password.length>=6&&(s.password=await o.default.hash(e.password,10)),await r.prisma.equipe.update({where:{id:a.id},data:s}),(0,i.revalidatePath)("/profile"),(0,i.revalidatePath)("/os"),{success:!0,message:"Perfil atualizado com sucesso!"}}catch(e){return n.logger.error("Error updating profile",{error:String(e)}),{message:"Erro ao atualizar perfil."}}}(0,s(46893).ensureServerEntryExports)([l,u,m,f,p,b]),(0,t.createActionProxy)("c5f7132601121f48314d1a51ecac279117f08ff6",l),(0,t.createActionProxy)("3a7a815bcde402ec80a76d4915ddaa24dd2697a6",u),(0,t.createActionProxy)("c98ca564b4813ac5836f5e16d8b41e62d1cf9860",m),(0,t.createActionProxy)("e0bf2b8da39f29f7764053adebc46527dec3237e",f),(0,t.createActionProxy)("2dd604a4fa171d5bf4edd119607f12882f2f1233",p),(0,t.createActionProxy)("bb9004a81e2ec4420b2b97debd5f27e567e92ef6",b)},7360:(e,a,s)=>{"use strict";s.r(a),s.d(a,{saveOSAdminInfo:()=>u});var t=s(98601);s(75811);var r=s(50841),i=s(68474),d=s(43811),o=s(73292),n=s(71017),c=s.n(n),l=s(6113);async function u(e){try{await (0,i.requireAdmin)()}catch(e){return{success:!1,message:"Acesso negado. Apenas administradores."}}let a=e.get("osId"),s=e.get("condominio"),t=e.get("descricao"),n=e.getAll("deletedFileIds"),u=e.getAll("files");if(!a)return{success:!1,message:"ID da OS inv\xe1lido."};try{if(await r.prisma.orderOfService.update({where:{id:a},data:{condominio:s,descricao:t}}),n.length>0){for(let e of(await r.prisma.oSAttachment.findMany({where:{id:{in:n}}})))try{let a=c().join(process.cwd(),"public",e.path);await (0,o.unlink)(a)}catch(e){console.error("Erro ao deletar arquivo do disco:",e)}await r.prisma.oSAttachment.deleteMany({where:{id:{in:n}}})}if(u.length>0){let e=c().join(process.cwd(),"public","uploads","os-files",a);try{await (0,o.mkdir)(e,{recursive:!0})}catch(e){}for(let s of u)if(s instanceof File&&s.size>0){let t=c().extname(s.name),i=s.name.replace(/[^a-zA-Z0-9.\-_]/g,"_"),d=`${(0,l.randomUUID)()}-${i}`,n=`/uploads/os-files/${a}/${d}`,u=c().join(e,d),m=Buffer.from(await s.arrayBuffer());await (0,o.writeFile)(u,m),await r.prisma.oSAttachment.create({data:{osId:a,name:s.name,path:n,type:s.type||t,size:s.size}})}}return(0,d.revalidatePath)(`/os/${a}`),(0,d.revalidatePath)("/os"),{success:!0,message:"Informa\xe7\xf5es salvas com sucesso."}}catch(e){return console.error("Erro ao salvar info admin:",e),{success:!1,message:"Erro interno ao salvar."}}}(0,s(46893).ensureServerEntryExports)([u]),(0,t.createActionProxy)("2e97a5facdd95a76e159016de9c21bb65bbde3ff",u)},31965:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>h});var t=s(25036),r=s(85843),i=s(55379),d=s(867),o=s(74801),n=s(16274),c=s(26540),l=s(44551),u=s(86843);let m=(0,u.createProxy)(String.raw`C:\Programas\PROJETOS\sistema-time-de-campo\src\app\os\[id]\admin\OSAdminEditForm.tsx`),{__esModule:f,$$typeof:p}=m;m.default;let b=(0,u.createProxy)(String.raw`C:\Programas\PROJETOS\sistema-time-de-campo\src\app\os\[id]\admin\OSAdminEditForm.tsx#OSAdminEditForm`);async function h({params:e}){let a=await (0,i.getSession)();a&&a.isAdmin||(0,d.redirect)("/");let s=await (0,r.ho)(e.id);return s?(0,t.jsxs)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 transition-colors",children:[t.jsx(o.c,{}),(0,t.jsxs)("div",{className:"container mx-auto max-w-2xl pt-24 px-4 pb-12",children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center gap-4",children:[t.jsx(n.default,{href:`/os/${s.id}`,className:"p-2 -ml-2 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full transition-colors",children:t.jsx(c.Z,{className:"h-6 w-6 text-slate-700 dark:text-slate-300"})}),(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Editar Informa\xe7\xf5es Administrativas"}),(0,t.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["OS: ",s.pop," | Protocolo: ",s.protocolo]})]})]}),(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{children:[t.jsx(l.ll,{children:"Informa\xe7\xf5es Adicionais"}),t.jsx(l.SZ,{children:"Adicione detalhes administrativos, nome do condom\xednio e anexos."})]}),t.jsx(l.aY,{children:t.jsx(b,{osId:s.id,initialData:{condominio:s.condominio,descricao:s.descricao,attachments:s.anexos}})})]})]})]}):(0,d.notFound)()}},44551:(e,a,s)=>{"use strict";s.d(a,{Ol:()=>o,SZ:()=>c,Zb:()=>d,aY:()=>l,ll:()=>n});var t=s(25036),r=s(40002),i=s(72245);let d=r.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));d.displayName="Card";let o=r.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...a}));o.displayName="CardHeader";let n=r.forwardRef(({className:e,...a},s)=>t.jsx("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...a}));n.displayName="CardTitle";let c=r.forwardRef(({className:e,...a},s)=>t.jsx("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",e),...a}));c.displayName="CardDescription";let l=r.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...a}));l.displayName="CardContent",r.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter"},85843:(e,a,s)=>{"use strict";s.d(a,{NO:()=>r,ho:()=>i});var t=s(81494);async function r(){return(await t._.orderOfService.findMany({include:{caixas:{select:{id:!0}},attachments:!0},orderBy:{pop:"asc"}})).map(e=>({id:e.id,pop:e.pop,status:e.status,uf:e.uf,dataEntrante:e.dataEntrante,dataPrevExec:e.dataPrevExec,dataConclusao:e.dataConclusao,mes:e.mes,valorServico:e.valorServico,statusMedicao:e.statusMedicao,statusFinal:e.statusFinal,tempo:e.tempo,facilidadesPlanejadas:e.facilidadesPlanejadas,caixasPlanejadas:e.caixasPlanejadas,tipoOs:e.tipoOs,cenario:e.cenario,protocolo:e.protocolo,totalCaixas:e.caixas.length,condominio:e.condominio||void 0,descricao:e.descricao||void 0,anexos:e.attachments.map(e=>({id:e.id,name:e.name,path:e.path,size:e.size,type:e.type}))}))}async function i(e){let a=await t._.orderOfService.findFirst({where:{OR:[{id:e},{pop:e}]},include:{caixas:{include:{photos:!0}},attachments:!0}});if(!a)return null;let s=await t._.equipe.findMany({select:{id:!0,fullName:!0,nomeEquipe:!0,name:!0}}),r=new Map;s.forEach(e=>{r.set(e.id,e.fullName||e.nomeEquipe||e.name)});let i=a.caixas.map(e=>{let s=[];s.push(a.pop),e.chassi&&s.push(e.chassi),e.placa&&s.push(e.placa),e.olt&&s.push(e.olt),s.push(e.cto);let t=e.equipe&&r.get(e.equipe)||e.nomeEquipe;return{id:e.id,cto:e.cto,pop:e.pop,cidade:e.cidade,uf:e.uf,chassi:e.chassi||void 0,placa:e.placa||void 0,olt:e.olt||void 0,cenario:e.cenario,bairro:e.bairro,chassiPath:s.filter(Boolean).join("/"),endereco:e.endereco||"",lat:e.lat,long:e.long,status:e.status,valor:e.valor,equipe:e.equipe,obs:e.obs,data:e.data,nomeEquipe:t,potencia:e.potencia,done:"OK"===e.status,certified:e.certified,photos:e.photos.map(e=>({id:e.id,path:e.path,equipeId:e.equipeId}))}});return{id:a.id,pop:a.pop,status:a.status,protocolo:a.protocolo,uf:a.uf,dataEntrante:a.dataEntrante,dataPrevExec:a.dataPrevExec,dataConclusao:a.dataConclusao,mes:a.mes,valorServico:a.valorServico,statusMedicao:a.statusMedicao,statusFinal:a.statusFinal,tempo:a.tempo,facilidadesPlanejadas:a.facilidadesPlanejadas,caixasPlanejadas:a.caixasPlanejadas,tipoOs:a.tipoOs,cenario:a.cenario,totalCaixas:i.length,items:i,condominio:a.condominio||void 0,descricao:a.descricao||void 0,anexos:a.attachments.map(e=>({id:e.id,name:e.name,path:e.path,size:e.size,type:e.type}))}}}};var a=require("../../../../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),t=a.X(0,[893,402,235,722,341,867,163,213],()=>s(51634));module.exports=t})();