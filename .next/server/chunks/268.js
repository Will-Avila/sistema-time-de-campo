exports.id=268,exports.ids=[268],exports.modules={94936:(e,a,t)=>{let r={"01aa194246fb3cd3909854170a6a003e66db9b89":()=>Promise.resolve().then(t.bind(t,55379)).then(e=>e.getSession),"6025ca35376357c0da7f5b807633b24af797ac4b":()=>Promise.resolve().then(t.bind(t,55379)).then(e=>e.clearSessionCookie),"7f6832b04b751148a6382dd64a1cc223449e53b3":()=>Promise.resolve().then(t.bind(t,55379)).then(e=>e.requireAuth),"8d8f3bd62d0a07b2792f9104701a5c0433fbcdee":()=>Promise.resolve().then(t.bind(t,55379)).then(e=>e.requireAdmin),bbad0871288a94d710af6fbd6788ce5f0465e0e3:()=>Promise.resolve().then(t.bind(t,55379)).then(e=>e.createToken),bdb6b21ecc9aab6757183c887af3cd3c576bd3b3:()=>Promise.resolve().then(t.bind(t,55379)).then(e=>e.setSessionCookie)};async function s(e,...a){return(await r[e]()).apply(null,a)}e.exports={"01aa194246fb3cd3909854170a6a003e66db9b89":s.bind(null,"01aa194246fb3cd3909854170a6a003e66db9b89"),"6025ca35376357c0da7f5b807633b24af797ac4b":s.bind(null,"6025ca35376357c0da7f5b807633b24af797ac4b"),"7f6832b04b751148a6382dd64a1cc223449e53b3":s.bind(null,"7f6832b04b751148a6382dd64a1cc223449e53b3"),"8d8f3bd62d0a07b2792f9104701a5c0433fbcdee":s.bind(null,"8d8f3bd62d0a07b2792f9104701a5c0433fbcdee"),bbad0871288a94d710af6fbd6788ce5f0465e0e3:s.bind(null,"bbad0871288a94d710af6fbd6788ce5f0465e0e3"),bdb6b21ecc9aab6757183c887af3cd3c576bd3b3:s.bind(null,"bdb6b21ecc9aab6757183c887af3cd3c576bd3b3")}},23673:(e,a,t)=>{"use strict";t.d(a,{Ol:()=>n,SZ:()=>c,Zb:()=>o,aY:()=>l,eW:()=>u,ll:()=>d});var r=t(95344),s=t(3729),i=t(11453);let o=s.forwardRef(({className:e,...a},t)=>r.jsx("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));o.displayName="Card";let n=s.forwardRef(({className:e,...a},t)=>r.jsx("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...a}));n.displayName="CardHeader";let d=s.forwardRef(({className:e,...a},t)=>r.jsx("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...a}));d.displayName="CardTitle";let c=s.forwardRef(({className:e,...a},t)=>r.jsx("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",e),...a}));c.displayName="CardDescription";let l=s.forwardRef(({className:e,...a},t)=>r.jsx("div",{ref:t,className:(0,i.cn)("p-6 pt-0",e),...a}));l.displayName="CardContent";let u=s.forwardRef(({className:e,...a},t)=>r.jsx("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",e),...a}));u.displayName="CardFooter"},30026:(e,a,t)=>{"use strict";t.d(a,{s:()=>n});var r=t(95344),s=t(23673),i=t(5094),o=t(65719);function n({open:e,title:a,message:t,confirmLabel:n="Confirmar",cancelLabel:d="Cancelar",variant:c="default",onConfirm:l,onCancel:u}){return e?r.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:r.jsx(s.Zb,{className:"w-full max-w-sm shadow-2xl dark:bg-slate-900 dark:border-slate-700",children:(0,r.jsxs)("div",{className:"p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-2 rounded-full shrink-0 ${"danger"===c?"bg-red-100 dark:bg-red-900/30":"bg-blue-100 dark:bg-blue-900/30"}`,children:r.jsx(o.Z,{className:`h-5 w-5 ${"danger"===c?"text-red-600 dark:text-red-400":"text-blue-600 dark:text-blue-400"}`})}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100",children:a}),r.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:t})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[r.jsx(i.z,{variant:"outline",onClick:u,className:"dark:border-slate-600 dark:text-slate-300",children:d}),r.jsx(i.z,{variant:"danger"===c?"destructive":"default",onClick:l,children:n})]})]})})}):null}},3923:(e,a,t)=>{"use strict";t.d(a,{O:()=>l});var r=t(95344),s=t(14513),i=t(71532),o=t(97751),n=t(89410),d=t(3729),c=t(81202);function l({isOpen:e,onClose:a,images:t,initialIndex:l=0}){let[u,f]=d.useState(l);(0,d.useEffect)(()=>{e&&f(l)},[e,l]);let m=(0,d.useCallback)(()=>{f(e=>(e+1)%t.length)},[t.length]),p=(0,d.useCallback)(()=>{f(e=>(e-1+t.length)%t.length)},[t.length]);return((0,d.useEffect)(()=>{if(!e)return;let t=e=>{"Escape"===e.key&&a(),"ArrowRight"===e.key&&m(),"ArrowLeft"===e.key&&p()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,a,m,p]),e&&"undefined"!=typeof document)?(0,c.createPortal)((0,r.jsxs)("div",{className:"fixed inset-0 z-[9999] bg-black/90 backdrop-blur-sm flex items-center justify-center animate-in fade-in duration-200",children:[r.jsx("button",{onClick:a,className:"absolute top-4 right-4 text-white/70 hover:text-white transition-colors bg-black/20 p-2 rounded-full hover:bg-white/10",children:r.jsx(s.Z,{className:"h-8 w-8"})}),t.length>1&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:e=>{e.stopPropagation(),p()},className:"absolute left-4 text-white/70 hover:text-white transition-colors hover:scale-110 p-2",children:r.jsx(i.Z,{className:"h-10 w-10 sm:h-12 sm:w-12"})}),r.jsx("button",{onClick:e=>{e.stopPropagation(),m()},className:"absolute right-4 text-white/70 hover:text-white transition-colors hover:scale-110 p-2",children:r.jsx(o.Z,{className:"h-10 w-10 sm:h-12 sm:w-12"})})]}),r.jsx("div",{className:"relative w-full h-full max-w-[90vw] max-h-[90vh] flex items-center justify-center pointer-events-none",children:r.jsx("div",{className:"relative w-full h-full pointer-events-auto",children:r.jsx(n.default,{src:t[u],alt:`Foto ${u+1}`,fill:!0,className:"object-contain",quality:90,priority:!0})})}),t.length>1&&(0,r.jsxs)("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 text-white/80 font-medium bg-black/40 px-3 py-1 rounded-full text-sm",children:[u+1," / ",t.length]})]}),document.body):null}},46540:(e,a,t)=>{"use strict";t.d(a,{I:()=>o});var r=t(95344),s=t(3729),i=t(11453);let o=s.forwardRef(({className:e,type:a,...t},s)=>r.jsx("input",{type:a,className:(0,i.cn)("flex h-11 w-full rounded-md border border-input bg-background px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all",e),ref:s,...t}));o.displayName="Input"},2690:(e,a,t)=>{"use strict";t.d(a,{g:()=>o});var r=t(95344),s=t(3729),i=t(11453);let o=s.forwardRef(({className:e,...a},t)=>r.jsx("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-4 py-3 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:t,...a}));o.displayName="Textarea"},72032:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});var r=t(34755);function s(e,a="info"){switch(a){case"success":r.Am.success(e);break;case"error":r.Am.error(e);break;case"warning":r.Am.warning(e);break;default:r.Am.info(e)}}},13398:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createEquipe:()=>u,deleteEquipe:()=>f,getEquipes:()=>p,updateEquipe:()=>m,updatePreferences:()=>l,updateProfile:()=>b});var r=t(98601);t(75811);var s=t(50841),i=t(43811),o=t(68474),n=t(28462),d=t(19961);function c(e){return/^[a-zA-Z0-9]+$/.test(e)}async function l(e,a){let t=await (0,o.requireAuth)().catch(()=>null);if(!t)return{message:"N\xe3o autenticado."};try{return await s.prisma.equipe.update({where:{id:t.id},data:{[e]:a}}),d.logger.info("Preferences updated",{userId:t.id,key:e,value:a}),(0,i.revalidatePath)("/os"),{success:!0}}catch(r){if("P2025"===r.code)return d.logger.error("Preferences update failed: User record not found. User needs to re-login.",{userId:t.id}),{message:"Sess\xe3o expirada ou usu\xe1rio n\xe3o encontrado. Por favor, saia e entre novamente."};return d.logger.error("Error updating preferences",{userId:t.id,key:e,value:a,error:String(r)}),{message:"Erro ao salvar prefer\xeancia."}}}async function u(e,a){try{await (0,o.requireAdmin)()}catch{return{message:"N\xe3o autorizado."}}let t=a.get("name"),r=a.get("fullName"),l=a.get("phone"),u=a.get("password"),f="true"===a.get("isAdmin");if(!t||!u||u.length<6)return{message:"Nome de usu\xe1rio e senha (min 6 caracteres) s\xe3o obrigat\xf3rios."};if(!c(t))return{message:"Nome de usu\xe1rio deve conter apenas letras e n\xfameros (sem espa\xe7os)."};try{if(await s.prisma.equipe.findUnique({where:{name:t}}))return{message:"J\xe1 existe um usu\xe1rio com este nome."};let e=await n.default.hash(u,10);return await s.prisma.equipe.create({data:{name:t,fullName:r,password:e,isAdmin:f,phone:l,nomeEquipe:t}}),(0,i.revalidatePath)("/admin/equipes"),{success:!0,message:`${f?"Administrador":"Usu\xe1rio/Equipe"} "${t}" criado com sucesso!`}}catch(e){if(d.logger.error("Error creating equipe",{error:String(e)}),"P2002"===e.code)return{message:"J\xe1 existe um usu\xe1rio com este nome."};return{message:"Erro ao criar usu\xe1rio: "+(e.message||"Erro desconhecido")}}}async function f(e){try{await (0,o.requireAdmin)()}catch{return{message:"N\xe3o autorizado."}}try{return await s.prisma.equipe.delete({where:{id:e}}),(0,i.revalidatePath)("/admin/equipes"),{success:!0}}catch(e){return d.logger.error("Error deleting equipe",{error:String(e)}),{message:"Erro ao remover usu\xe1rio."}}}async function m(e,a){try{await (0,o.requireAdmin)()}catch{return{message:"N\xe3o autorizado."}}try{let t={};if(a.name){if(!c(a.name))return{message:"Nome de usu\xe1rio deve conter apenas letras e n\xfameros."};t.name=a.name}return void 0!==a.fullName&&(t.fullName=a.fullName),void 0!==a.phone&&(t.phone=a.phone),a.password&&a.password.length>=6&&(t.password=await n.default.hash(a.password,10)),void 0!==a.isAdmin&&(t.isAdmin=a.isAdmin),await s.prisma.equipe.update({where:{id:e},data:t}),(0,i.revalidatePath)("/admin/equipes"),{success:!0,message:"Usu\xe1rio atualizado!"}}catch(e){return d.logger.error("Error updating equipe",{error:String(e)}),{message:"Erro ao atualizar usu\xe1rio."}}}async function p(){return s.prisma.equipe.findMany({select:{id:!0,name:!0,fullName:!0,nomeEquipe:!0,phone:!0,isAdmin:!0,createdAt:!0,updatedAt:!0},orderBy:{createdAt:"desc"}})}async function b(e){let a=await (0,o.requireAuth)().catch(()=>null);if(!a)return{message:"N\xe3o autenticado."};try{let t={};if(e.name){if(!c(e.name))return{message:"Nome de usu\xe1rio deve conter apenas letras e n\xfameros."};if(await s.prisma.equipe.findFirst({where:{name:e.name,NOT:{id:a.id}}}))return{message:"Este nome de usu\xe1rio j\xe1 est\xe1 em uso."};t.name=e.name}return void 0!==e.fullName&&(t.fullName=e.fullName),void 0!==e.phone&&(t.phone=e.phone),e.password&&e.password.length>=6&&(t.password=await n.default.hash(e.password,10)),await s.prisma.equipe.update({where:{id:a.id},data:t}),(0,i.revalidatePath)("/profile"),(0,i.revalidatePath)("/os"),{success:!0,message:"Perfil atualizado com sucesso!"}}catch(e){return d.logger.error("Error updating profile",{error:String(e)}),{message:"Erro ao atualizar perfil."}}}(0,t(46893).ensureServerEntryExports)([l,u,f,m,p,b]),(0,r.createActionProxy)("c5f7132601121f48314d1a51ecac279117f08ff6",l),(0,r.createActionProxy)("3a7a815bcde402ec80a76d4915ddaa24dd2697a6",u),(0,r.createActionProxy)("c98ca564b4813ac5836f5e16d8b41e62d1cf9860",f),(0,r.createActionProxy)("e0bf2b8da39f29f7764053adebc46527dec3237e",m),(0,r.createActionProxy)("2dd604a4fa171d5bf4edd119607f12882f2f1233",p),(0,r.createActionProxy)("bb9004a81e2ec4420b2b97debd5f27e567e92ef6",b)},85843:(e,a,t)=>{"use strict";t.d(a,{NO:()=>s,ho:()=>i});var r=t(81494);async function s(){return(await r._.orderOfService.findMany({include:{caixas:{select:{id:!0}},attachments:!0},orderBy:{pop:"asc"}})).map(e=>({id:e.id,pop:e.pop,status:e.status,uf:e.uf,dataEntrante:e.dataEntrante,dataPrevExec:e.dataPrevExec,dataConclusao:e.dataConclusao,mes:e.mes,valorServico:e.valorServico,statusMedicao:e.statusMedicao,statusFinal:e.statusFinal,tempo:e.tempo,facilidadesPlanejadas:e.facilidadesPlanejadas,caixasPlanejadas:e.caixasPlanejadas,tipoOs:e.tipoOs,cenario:e.cenario,protocolo:e.protocolo,totalCaixas:e.caixas.length,condominio:e.condominio||void 0,descricao:e.descricao||void 0,anexos:e.attachments.map(e=>({id:e.id,name:e.name,path:e.path,size:e.size,type:e.type}))}))}async function i(e){let a=await r._.orderOfService.findFirst({where:{OR:[{id:e},{pop:e}]},include:{caixas:{include:{photos:!0}},attachments:!0}});if(!a)return null;let t=await r._.equipe.findMany({select:{id:!0,fullName:!0,nomeEquipe:!0,name:!0}}),s=new Map;t.forEach(e=>{s.set(e.id,e.fullName||e.nomeEquipe||e.name)});let i=a.caixas.map(e=>{let t=[];t.push(a.pop),e.chassi&&t.push(e.chassi),e.placa&&t.push(e.placa),e.olt&&t.push(e.olt),t.push(e.cto);let r=e.equipe&&s.get(e.equipe)||e.nomeEquipe;return{id:e.id,cto:e.cto,pop:e.pop,cidade:e.cidade,uf:e.uf,chassi:e.chassi||void 0,placa:e.placa||void 0,olt:e.olt||void 0,cenario:e.cenario,bairro:e.bairro,chassiPath:t.filter(Boolean).join("/"),endereco:e.endereco||"",lat:e.lat,long:e.long,status:e.status,valor:e.valor,equipe:e.equipe,obs:e.obs,data:e.data,nomeEquipe:r,potencia:e.potencia,done:"OK"===e.status,certified:e.certified,photos:e.photos.map(e=>({id:e.id,path:e.path,equipeId:e.equipeId}))}});return{id:a.id,pop:a.pop,status:a.status,protocolo:a.protocolo,uf:a.uf,dataEntrante:a.dataEntrante,dataPrevExec:a.dataPrevExec,dataConclusao:a.dataConclusao,mes:a.mes,valorServico:a.valorServico,statusMedicao:a.statusMedicao,statusFinal:a.statusFinal,tempo:a.tempo,facilidadesPlanejadas:a.facilidadesPlanejadas,caixasPlanejadas:a.caixasPlanejadas,tipoOs:a.tipoOs,cenario:a.cenario,totalCaixas:i.length,items:i,condominio:a.condominio||void 0,descricao:a.descricao||void 0,anexos:a.attachments.map(e=>({id:e.id,name:e.name,path:e.path,size:e.size,type:e.type}))}}}};